<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<title>测试详情</title>
		<link rel="stylesheet" type="text/css" href="../../css/ct.css"/>
		<style type="text/css">
			.ct-icon-angle-left{
				display: inline-block;
				position: absolute;
				width: 35px;
				height: 100%;
				line-height: 50px;
				left: 0;
				top: 0;
				color: #B3A69A;
			}
			.title{
				color: #B3A69A;
			}
			.topbar > .flex-1{
				/*line-height: 50px;*/
			}
			.topbar{
				text-align: left;
				padding: 0 1.8em;
			}
			footer{
				position: fixed;
				line-height: 55px;
				height: 55px;
				bottom: 0;
				left: 0;
				background-color: #fff;
				width: 100%;
				text-align: center;
				border-top:1px solid #ddd;
			}
		.ce_cart{
			width: 120px;
			height: 35px;
			margin-top: 10px;
			border-radius: 4px;
			background-color: #19b5fe;
			position: absolute;
			left: 8%;
			color: #fff;
			line-height: 35px;
			text-align: center;
		}
		.tubiao_cart{
			margin-top: 9px;
			margin-left: 9px;
			margin-right: 5px;
			color: #fff;
		}
		.ce_buy{
			width: 120px;
			height: 35px;
			margin-top: 10px;
			border-radius: 4px;
			background-color: #f15352;
			position: absolute;
			right:8%;
			color: #fff;
			line-height: 35px;
			text-align: center;
		}
		.cell{
			background-color: #FFFFFF;
			padding: 5px;
			margin: 5px;
			position: relative;
			padding-bottom: 15px;
		}
		.cell .img-frm,
		.cell .img{
			background-repeat: no-repeat;
			background-size: cover;
			background-position: center;
		}
		.cell .img-frm{
			width: 100%;
			height: 100px;
			background-image: url(../../res/loading2_400x400.png);
		}
		.cell .img{
			width: 100%;
			height: 100%;
		}
		.cell .title{
			font-size: 14px;
			padding-bottom: 10px;

		}
		.cell .price{
			color: red;
		}		
		.list-view{
			line-height: 45px;
			padding-left: 20px;
			color: #999;
			background-color: #fff;
			border-bottom: 1px solid #eee;
		}
		a{
			display: block;
			width: 100%;
		}
		.cell .comment{
			position: absolute;
			right: 5px;
			bottom: 5px;
			font-size: 12px;
		}
		.text-pingjia{
			line-height: 50px;
			border-bottom:1px solid #ededed;
			background-color: #fff;
			
		}
		.tuwen_details{
			margin-top: 10px;
			line-height: 50px;
			background-color: #fff;
			border: 1px solid #ededed;
		}
		.tuwen{
			font-size: 25px;
			margin-right: 0.5em;
			margin-left: 0.5em;
			margin-top: 0.5em;
			color: #999;
		}
		.ce_datails
		{
			color: #000;
			
		}
		.tuwen_details .datails_wifi{
			color: #999;
			font-size: 0.8em;
			line-height: 52px;
		}
		</style>
	</head>
	<body>
		<div id="wrap">
			<div id="main" style="background-color: #F3F3F3;">
				<section class="hidden">
					<div class="flex-box" style="padding: 8px 10px;background-color: #fff;">
						<div class="flex-1 text-overflow" style="line-height: 24px;">
							U盘可靠性试验
						</div>
						<div class="flex-1">
							<span style="font-size: 14px;color: #999">价格：</span>
							<span style="color:red;font-size: 18px;">￥620.00/5次</span>
						</div>
					</div>
					<div style="padding: 5px">
						<h4>套餐测试内容</h4>
						<div class="flex-box">
							<div class="flex-1 cell">
								<div class="img-frm">
									<div class="img"></div>
								</div>
								<div class="title text-center">
									耐旱接热(DIP方式)
								</div>
								<div class="price text-center">
									￥150.00
								</div>
							</div>
							<div class="flex-1 cell">
								<div class="img-frm">
									<div class="img"></div>
								</div>
								<div class="title text-center">
									耐旱接热(DIP方式)
								</div>
								<div class="price text-center">
									￥150.00
								</div>
							</div>
						</div>
						<div class="flex-box">
							<div class="flex-1 cell">
								<div class="img-frm">
									<div class="img"></div>
								</div>
								<div class="title text-center">
									耐旱接热(DIP方式)
								</div>
								<div class="price text-center">
									￥150.00
								</div>
								<div class="comment">
									<span class="ct-icon-news"></span>
									(15)
								</div>
							</div>
							<div class="flex-1 cell">
								<div class="img-frm">
									<div class="img"></div>
								</div>
								<div class="title text-center">
									耐旱接热(DIP方式)
								</div>
								<div class="price text-center">
									￥150.00
								</div>
							</div>
						</div>
					</div>
					
					<div>
						<div class="flex-box list-view">
							<span class="ct-icon-note" style="font-size: 20px;color:#999;top:10px;margin-right: 10px;"></span>
							测试图文详情
							<span class="small" style="font-size: 12px;color:#bbb">(建议在wifi下查看)</span>
						</div>
						<div class="flex-box list-view">
							<span class="ct-icon-join" style="font-size: 20px;color:#999;top:10px;margin-right: 10px;"></span>
							测试评价(18)
						</div>
						<div class="flex-box list-view">
							<span class="ct-icon-star" style="font-size: 20px;color:#999;top:10px;margin-right: 10px;"></span>
							收藏测试
						</div>
					</div>					
				</section>

			</div>
			<!--<footer class="">
				<div class="flex-box cart_bottom">
					<div class="flex-box ce_cart" onclick="etestCartAdd(id)" tapmode="">
						<span class="ct-icon-cart tubiao_cart"></span>
						加入测试车
					</div>
					<div class="flex-box ce_buy"><span class="ct-icon-card tubiao_cart"></span>立即购买</div>
				</div>
			</footer>-->
		</div>
	</body>
	<script type="text/template" template="main">
		<section>
				<div class="flex-box" style="padding: 8px 10px;background-color: #fff;">
					<div class="flex-1 text-overflow" style="line-height: 24px;">
						{{= it.title }}
					</div>
					<div class="flex-1">
						<span style="font-size: 14px;color: #999">价格：</span>
						<span style="color:red;font-size: 18px;">￥{{= it.price }}</span>
					</div>
				</div>
				<div style="padding: 5px">
					<h4>套餐测试内容</h4>
					{{ if(it.Test instanceof Array && it.Test.length!=0){ }}
						{{~it.Test :value:index }}
							{{? index%2==0 }}
								<div class="flex-box">
									<div class="flex-1 cell" style="width:{{= (document.documentElement.clientWidth-30)/2 }}px">
										<a href="my_single_details.html?testid={{= value.test_id }}">
											<div class="img-frm">
												<div class="img" style="background-image: url({{= value.test_cover }});"></div>
											</div>
											<div class="title text-center">
												{{= value.test_title }}
											</div>
											<div class="price text-center">
												￥{{= value.test_price }}
											</div>
											<div class="comment">
												<span class="ct-icon-news"></span>
												({{= value.test_comment||0 }})
											</div>											
										</a>
									</div>
									{{? index+1<it.Test.length }}
									<div class="flex-1 cell" style="width:{{= (document.documentElement.clientWidth-30)/2 }}px">
										<a href="my_single_details.html?testid={{= it.Test[index+1].test_id }}">
											<div class="img-frm">
												<div class="img" style="background-image: url({{= it.Test[index+1].test_cover }});"></div>
											</div>
											<div class="title text-center">
												{{= it.Test[index+1].test_title }}
											</div>
											<div class="price text-center">
												￥{{= it.Test[index+1].test_price }}
											</div>
											<div class="comment">
												<span class="ct-icon-news"></span>
												({{= value.test_comment||0 }})
											</div>
										</a>
									</div>
									{{?}}
								</div>
							{{?}}
						{{~}}
					{{ } }}
				</div>
				
					<div>
						<div class="flex-box list-view" onclick="openDescription({{= it.testpackage_id }})" tapmode="">
							<span class="ct-icon-note" style="font-size: 20px;color:#999;top:10px;margin-right: 10px;"></span>
							测试图文详情
							<span class="small" style="font-size: 12px;color:#bbb">(建议在wifi下查看)</span>
						</div>
						<div class="flex-box list-view" onclick="openStarCommentList('Test', 'testComment', {{=it.testpackage_id}}, 2)">
							<span class="ct-icon-join" style="font-size: 20px;color:#999;top:10px;margin-right: 10px;"></span>
							测试评价({{= it.comment }})
						</div>
						{{? $api.getStorage('memberInfo') }}
					    <div class="flex-box text-pingjia " onclick="testpackagecollection('{{= it.testpackage_id }}')" tapmode=""> 
								{{ if($api.getStorage('memberInfo')){ }}
									{{ if($api.getStorage('memberInfo').testpackagecollection.indexOf(it.testpackage_id.toString())>=0){ }}						
										<span class="ct-icon-star_select tuwen collect" ></span>
								{{ }else{ }}		
										<span class="ct-icon-star tuwen collect" tapmode=""></span>
									{{ } }}
								{{ } }}
								<span class="ce_datails">收藏测试</span>
				      </div>
				    {{?}} 
					</div>		
			</section>
	</script>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/common.js" ></script>
	<script type="text/javascript" src="../../script/doT.min.js" ></script>
	<script type="text/javascript" src="../../script/cart.js" ></script>
	<script type="text/javascript">
		//预定义变量，用于加入测试车
		var tid, title, price, cover;
		function addCart(){
			Cart.push({
				cartName: 'myTestCart',
				goods: {
					type: 1,
					tid: tid,
					title: title,
					price: price,
					cover: cover,
					num: 1
				}
			});
			toast('添加测试车成功');
		}
		function openDescription(testpackage_id){
			api.openWin({
				name: 'Description',
				url: api.wgtRootDir + '/html/window/win.html',
				pageParam: {
					headerTitle: '图文详情',
					frameName: '_description',
					frameUrl: api.wgtRootDir + '/html/home/description.html',
					hasFrameParam: true,
					frameParam: {
						id: testpackage_id,
						type: 3
					}
				},
				bounces: false
			});			
		}
		function openComment(){
			api.openWin({
				name: 'TestComment',
				url: api.wgtRootDir + '/html/window/win.html',
				pageParam: {
					headerTitle: '评论列表',
					frameName: 'test_comment',
					frameUrl: api.wgtRootDir + '/html/home/test_comment.html',
					hasFrameParam: true,
					frameParam: {
						id: id
					}
				},
				bounces: false
			});				
		}
		
		function testpackagecollection(id){
			var flag = 0;
			if(!$api.hasCls($api.dom('.collect'), 'ct-icon-star_select')){
				flag = 1;
			}
			tool.ajax.get({
				hideLoading:true,
				ctrl: 'Test',
				fn: 'testCollect',
				data: {
					values: {
						id: $api.getStorage('memberId'),
						token: $api.getStorage('token'),
						type:1,
						testid: id
					}
				}
			}, function(ct){
				var memberInof = $api.getStorage('memberInfo');
				if(flag){
					toast('收藏成功');
					$api.addCls($api.removeCls($api.dom('.collect'), 'ct-icon-star'), 'ct-icon-star_select');
					memberInof.testpackagecollection.push(id);
				}else{
					toast('已取消收藏');
					$api.addCls($api.removeCls($api.dom('.collect'), 'ct-icon-star_select'), 'ct-icon-star');
					var _index = memberInof.testpackagecollection.indexOf(id);
					memberInof.testpackagecollection.splice(_index, 1);
				}
				$api.setStorage('memberInfo', memberInof);
			});
		}	
//		function collect(id, _this){
//			var spanDom = $api.dom(_this, 'span'),
//					isCollect;
//			if($api.hasCls(spanDom, 'ct-icon-star_select')){
//				isCollect = 0;
//			}else{
//				isCollect = 1;
//			}
//			tool.ajax.get({
//				ctrl: 'Test',
//				fn: 'testCollect',
//				data: {
//					values: {
//						id: $api.getStorage('memberId'),
//						token: $api.getStorage('token'),
//						type: 1,
//						testid: id
//					}
//				},
//				hideLoading: true
//			}, function(){
//				if(isCollect){
//					toast('成功收藏');
//					$api.addCls($api.removeCls(spanDom, 'ct-icon-star'), 'ct-icon-star_select');
//				}else{
//					toast('已取消收藏');
//					$api.addCls($api.removeCls(spanDom, 'ct-icon-star_select'), 'ct-icon-star');
//				}
//			});
//		}
		function reload(id){
			tool.ajax.get({
				ctrl: "Test",
				fn: "testpackageDetails",
				hideLoading:true,
				data: {
					values: {
						testpackageid: id
					}
				}
			},function(ct){
				tid = ct.testpackage_id;
				title = ct.title;
				price = ct.price;
				cover = ct.cover[0];
				mt('#main', 'main', ct);
//				 $api.html($api.dom('#main'), doT.template($api.html($api.dom('[template=main]')))(ct));
			});
		}
		apiready = function(){
			reload(api.pageParam.id);	
		};	
	</script>
</html>